const a0_0x3080 = ['getSystemInfoSync', '&sv=', 'mfsw', '&sl=', '^https?:\x5c/\x5c/', 'platform', 'get', 'ceil', 'length', 'repeat', 'GET', '&kv=', '&pt=', 'join', 'data', 'push', 'stack', 'keys', 'sort', 'method', 'version', 'request', 'random', 'slice', 'error', '&sign=', '.*?\x5c.missfresh\x5c.net', 'split', '../external/utfx.min.js', 'ts=', 'toString', '&len=', 'charCodeAt', 'mr\x20ERROR:', 'call', 'WW4oU6KFwqS7cII3ctikg7WJBk7GyZuG', 'assign', 'url', '000001', 'stringify', '.*?\x5c.missfresh\x5c.cn', '&wv=', 'prototype', 'some', 'map', '&av=', 'header', '&wxe=', 'params'];
(function (_0x362af1, _0x3080fb) {
  const _0x569a10 = function (_0x3c1de7) {
    while (--_0x3c1de7) {
      _0x362af1['push'](_0x362af1['shift']());
    }
  };
  _0x569a10(++_0x3080fb);
}(a0_0x3080, 0x127));
const a0_0x569a = function (_0x362af1, _0x3080fb) {
  _0x362af1 = _0x362af1 - 0x0;
  let _0x569a10 = a0_0x3080[_0x362af1];
  return _0x569a10;
};
const _0xc12764 = function (_0x491fa3, _0x2100f2) {
  return a0_0x569a(_0x491fa3 - -'0x33e', _0x2100f2);
}, _0x34c441 = function (_0x52bfc6, _0x11db01) {
  return a0_0x569a(_0x52bfc6 - -'0x33e', _0x11db01);
}, _0x380764 = function (_0xf9139c, _0x548fdd) {
  return a0_0x569a(_0xf9139c - -'0x33e', _0x548fdd);
}, _0x4ec19b = function (_0x2736e, _0x4cc306) {
  return a0_0x569a(_0x2736e - -'0x33e', _0x4cc306);
}, _0x11560a = function (_0x1e342b, _0x3c143f) {
  return a0_0x569a(_0x1e342b - -'0x33e', _0x3c143f);
};
import {parseUrl} from '../utils';
import {mb} from '../external/mfs-base64';

const md5 = require('../external/md5.min.js'), encodeUTF16toUTF8 = require(_0xc12764(-'0x323'))['encodeUTF16toUTF8'],
  MAX_BYTE = 0x800, AV = '02', KV = _0x34c441(-'0x319'), SECRET = _0x380764(-'0x31c'),
  MF_DOMAIN = [_0x4ec19b(-'0x317'), _0x11560a(-'0x325')];

function randomData(_0x3c1de7) {
  const _0x4a201f = function (_0x1d725f, _0x21e113) {
      return _0x11560a(_0x1d725f - -'0x1fa', _0x21e113);
    }, _0x14edae = function (_0x4576c8, _0x25441b) {
      return _0x380764(_0x4576c8 - -'0x1fa', _0x25441b);
    }, _0x4f2a34 = function (_0x4f65dd, _0x3ba06d) {
      return _0x380764(_0x4f65dd - -'0x1fa', _0x3ba06d);
    }, _0x1938cb = function (_0x215782, _0x48f255) {
      return _0x4ec19b(_0x215782 - -'0x1fa', _0x48f255);
    }, _0x3c4b5c = function (_0x5b173c, _0x1a5dd6) {
      return _0xc12764(_0x5b173c - -'0x1fa', _0x1a5dd6);
    },
    _0x53c0ae = MF_DOMAIN[_0x4a201f(-'0x50e')](_0x40104e => new RegExp(_0x14edae(-'0x535') + _0x40104e)['test'](_0x3c1de7));
  if (!_0x53c0ae) {
    let _0x3ff953 = '' + Math[_0x14edae(-'0x532')](Math[_0x4f2a34(-'0x523')]() * 0x2710);
    return '0'['repeat'](0x4 - _0x3ff953[_0x14edae(-'0x531')]) + _0x3ff953;
  }
  return '';
}

function _utf16ToUtf8A(_0x1b7a08) {
  let _0x1fb7b0 = Math['min'](_0x1b7a08['length'], MAX_BYTE), _0x316b7a = 0x0, _0x53f789 = [];
  return encodeUTF16toUTF8(() => {
    const _0x3b4903 = function (_0x1cf889, _0x4e1ea4) {
      return a0_0x569a(_0x1cf889 - -'0x56', _0x4e1ea4);
    }, _0x16cf62 = function (_0x857bd6, _0x5140a8) {
      return a0_0x569a(_0x857bd6 - -'0x56', _0x5140a8);
    };
    return _0x316b7a < _0x1fb7b0 && _0x53f789[_0x3b4903(-'0x4f')] < MAX_BYTE ? _0x1b7a08[_0x3b4903(-'0x37')](_0x316b7a++) : null;
  }, _0x567a35 => {
    const _0x237db1 = function (_0x6f23be, _0x51ad76) {
      return a0_0x569a(_0x6f23be - -'0xe8', _0x51ad76);
    };
    _0x53f789[_0x237db1(-'0xda')](_0x567a35);
  }), _0x53f789;
}

const _lmt_s = _0x220104 => _utf16ToUtf8A(_0x220104)[_0x380764(-'0x328')](0x0, MAX_BYTE)['map'](_0x2a15ba => _0x2a15ba[_0xc12764(-'0x321')](0x10))[_0x11560a(-'0x332')](''),
  _str_l = _0x486042 => _utf16ToUtf8A(_0x486042)[_0x34c441(-'0x337')];

function obfuscateMixdata(_0x2c616e, _0x56da83) {
  const _0x175be1 = function (_0x33724a, _0x3b0640) {
    return _0x34c441(_0x33724a - -'0x118', _0x3b0640);
  }, _0x57052a = function (_0x3f98b3, _0x4367d5) {
    return _0x380764(_0x3f98b3 - -'0x118', _0x4367d5);
  }, _0x182dea = function (_0x496a3f, _0x3ed360) {
    return _0x11560a(_0x496a3f - -'0x118', _0x3ed360);
  }, _0xdee349 = function (_0x456ee4, _0x5a3fb5) {
    return _0x34c441(_0x456ee4 - -'0x118', _0x5a3fb5);
  }, _0x12d1f5 = function (_0xd3c683, _0x112773) {
    return _0x380764(_0xd3c683 - -'0x118', _0x112773);
  };
  _0x56da83 = '0'[_0x175be1(-'0x44e')](0x4 - _0x56da83[_0x175be1(-'0x44f')]) + _0x56da83;
  const _0x580bf9 = Array[_0x57052a(-'0x42d')][_0xdee349(-'0x42b')]['call'](_0x56da83, _0x578c56 => _0x578c56[_0x182dea(-'0x437')](0x0)),
    _0x5136d9 = [];
  return Array[_0x182dea(-'0x42d')]['forEach'][_0x12d1f5(-'0x435')](_0x2c616e, (_0x56366f, _0x344857) => {
    const _0x1bfd4a = function (_0x40591a, _0x475326) {
      return _0x12d1f5(_0x40591a - '0x1f', _0x475326);
    }, _0x20f043 = function (_0x3f3b0d, _0x2fd99a) {
      return _0x175be1(_0x3f3b0d - '0x1f', _0x2fd99a);
    };
    _0x5136d9[_0x1bfd4a(-'0x429')]((_0x2c616e[_0x1bfd4a(-'0x418')](_0x344857) + _0x580bf9[_0x344857 % 0x4]) % 0x100);
  }), [..._0x580bf9, ..._0x5136d9];
}

function getReqData(_0x471442) {
  const _0x36e6af = function (_0x4b11ea, _0x59fbb2) {
      return _0x4ec19b(_0x4b11ea - -'0x375', _0x59fbb2);
    }, _0x17ade0 = function (_0xe36f94, _0x4c6429) {
      return _0x11560a(_0xe36f94 - -'0x375', _0x4c6429);
    }, _0x50bb77 = function (_0x445197, _0x3be623) {
      return _0x11560a(_0x445197 - -'0x375', _0x3be623);
    }, _0x13c99c = function (_0x114d5c, _0x9e1a0) {
      return _0x4ec19b(_0x114d5c - -'0x375', _0x9e1a0);
    }, _0x167711 = function (_0x502b72, _0x1f56f1) {
      return _0x4ec19b(_0x502b72 - -'0x375', _0x1f56f1);
    },
    _0x7e49b8 = !_0x471442[_0x36e6af(-'0x6a1')] || _0x471442[_0x36e6af(-'0x6a1')] === _0x36e6af(-'0x6aa') || _0x471442[_0x17ade0(-'0x6a1')] === _0x167711(-'0x6ae');
  let _0x5b596b = _0x7e49b8 && _0x471442[_0x17ade0(-'0x6a6')] || {},
    _0x2c53f8 = !_0x7e49b8 && _0x471442[_0x17ade0(-'0x6a6')] || {},
    _0x52c3d0 = parseUrl(_0x471442[_0x17ade0(-'0x68f')]);
  _0x5b596b = Object[_0x13c99c(-'0x690')]({}, _0x52c3d0[_0x167711(-'0x684')] || {}, _0x5b596b);
  let _0x164593 = {}, _0x39d874;
  for (_0x39d874 in _0x5b596b) {
    _0x164593['' + _0x39d874 + decodeURIComponent(void 0x0 !== _0x5b596b[_0x39d874] ? _0x5b596b[_0x39d874] : '')] = !0x0;
  }
  if (!_0x7e49b8) {
    let _0x49eaa2 = '';
    try {
      _0x49eaa2 = JSON[_0x36e6af(-'0x68d')](_0x2c53f8);
    } catch (_0x22279a) {
      _0x49eaa2 = '';
    }
    let _0x184726 = _lmt_s(_0x49eaa2);
    _0x184726 && (_0x164593[_0x184726] = !0x0);
  }
  return Object[_0x167711(-'0x6a3')](_0x164593)[_0x17ade0(-'0x6a2')]((_0x3929f3, _0x25ba60) => _0x3929f3 > _0x25ba60 ? -0x1 : _0x3929f3 < _0x25ba60 ? 0x1 : 0x0)['join']('') + randomData(_0x471442[_0x167711(-'0x68f')]);
}

function reqSign(_0x454a2b) {
  const _0x3369e1 = function (_0x2f7e2b, _0x47ea29) {
    return _0x4ec19b(_0x2f7e2b - -'0x111', _0x47ea29);
  }, _0x1dca13 = function (_0x312837, _0x3ef697) {
    return _0xc12764(_0x312837 - -'0x111', _0x3ef697);
  }, _0x244cda = function (_0x3c3ce4, _0x52b662) {
    return _0x11560a(_0x3c3ce4 - -'0x111', _0x52b662);
  }, _0x4a717b = function (_0x2d42f8, _0x36dec6) {
    return _0x34c441(_0x2d42f8 - -'0x111', _0x36dec6);
  }, _0x5be3ae = function (_0x453dc9, _0x3fdf1e) {
    return _0x380764(_0x453dc9 - -'0x111', _0x3fdf1e);
  };
  try {
    const _0x1a1d4c = getReqData(_0x454a2b), _0x452982 = md5(SECRET + _0x1a1d4c), _0x4a029f = Date['now'](),
      _0x5bb0cc = Math[_0x3369e1(-'0x449')](_0x4a029f / 0x2710), _0x537539 = _str_l(_0x1a1d4c);
    let _0x20008a = '', _0xf3ce18 = '', _0x961a99 = '', _0x57cdfc = '', _0x4d23d1 = 0x1;
    try {
      _0x20008a = new Error()[_0x1dca13(-'0x440')][_0x244cda(-'0x435')]('\x0a')['length'];
      const _0xe89324 = wx[_0x4a717b(-'0x41f')]();
      _0x4d23d1 = 0x0, _0xf3ce18 = _0xe89324[_0x5be3ae(-'0x43c')], _0x961a99 = _0xe89324['system'], _0x57cdfc = _0xe89324[_0x3369e1(-'0x44b')];
    } catch (_0x17b082) {
    }
    const _0x5dac52 = _0x3369e1(-'0x433') + _0x5bb0cc + _0x5be3ae(-'0x437') + _0x452982 + _0x3369e1(-'0x431') + _0x537539 + _0x1dca13(-'0x445') + KV + _0x3369e1(-'0x423') + AV + _0x3369e1(-'0x44d') + _0x20008a + _0x1dca13(-'0x421') + _0x4d23d1 + _0x244cda(-'0x427') + _0xf3ce18 + _0x4a717b(-'0x44f') + _0x961a99 + _0x1dca13(-'0x444') + _0x57cdfc,
      _0x210f5e = obfuscateMixdata(_0x5dac52, '' + _0x4a029f % 0x2710),
      _0x524f8b = _0x1dca13(-'0x44e') + mb['encode'](_0x210f5e);
    !_0x454a2b[_0x3369e1(-'0x422')] && (_0x454a2b[_0x3369e1(-'0x422')] = {}), _0x454a2b['header']['mfsig'] = _0x524f8b;
  } catch (_0x12a95e) {
    console[_0x4a717b(-'0x438')](_0x3369e1(-'0x42f'), _0x12a95e);
  }
  return _0x454a2b;
}

export const mr = _0x1bf436 => {
  const _0x53ca73 = function (_0xb9330, _0x4ed801) {
    return _0xc12764(_0xb9330 - '0x19', _0x4ed801);
  };
  return _0x1bf436 = reqSign(_0x1bf436), wx[_0x53ca73(-'0x311')](_0x1bf436);
};